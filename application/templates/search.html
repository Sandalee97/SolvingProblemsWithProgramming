<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Results</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <h2>Search Results for "{{ q }}"</h2>
    <a href="/dashboard" class="btn btn-secondary btn-sm mb-3">Back to Dashboard</a>
    {% if results %}
        <ul class="list-group">
        {% for r in results %}
            <li class="list-group-item">
                <a href="{{ url_for('view_file', cab_id=r.cab_id, drawer_idx=r.drawer_idx, file_idx=r.file_idx) }}"><strong>{{ r.file.title }}</strong></a>
                <span class="badge bg-info ms-2">{{ r.file.category }}</span><br>
                <small>Cupboard: {{ r.cupboard.name }} &middot; Drawer: {{ r.drawer_name }}</small><br>
                Created: {{ r.file.created }} &middot; Status: {{ r.file.status|default('N/A')|capitalize }}
                <details class="mt-2">
                    <summary>History</summary>
                    <ul>
                    {% for h in r.file.history %}
                        <li>{{ h.action|capitalize }}{% if h.by %} by {{ h.by }}{% endif %}{% if h.to %} to {{ h.to }}{% endif %} on {{ h.date }}{% if h.expected_return %} (Expected return: {{ h.expected_return }}){% endif %}{% if h.note %} - {{ h.note }}{% endif %}</li>
                    {% endfor %}
                    </ul>
                </details>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <div class="alert alert-warning">No files found matching your search.</div>
    {% endif %}
</div>
</body>
</html>
